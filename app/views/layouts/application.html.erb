<!DOCTYPE html>
<html data-theme="light">
  <head>
    <title><%= content_for(:title) || "Summa" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Summa">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QL65Ik5+pUvNbK/CtYQgQki71R+xVQ1BM8DT6vKrrf5evkP7FpC18JNpD33rDg14" crossorigin="anonymous">

    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag :application, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ug1YpRP70dNDO7xjoMnIKh4j/wcgUp3NEPoPFcAckU4iigFsMghvYDn8ApX2HFqT" crossorigin="anonymous"></script>

    <%= yield :head %>

    <style>
      /* Inline fallback to keep navbar horizontal even if external CSS fails */
      .navbar {
        display: flex;
        align-items: center;
        gap: 14px;
        padding: 10px 14px;
        background: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
        flex-wrap: nowrap;
      }
      .navbar .container-fluid { display: flex; align-items: center; gap: 14px; flex-wrap: nowrap; }
      .navbar-collapse { display: flex !important; align-items: center; gap: 12px; flex: 1; min-width: 0; }
      .navbar-toggler { display: none; }
      .navbar-brand { font-weight: 700; text-decoration: none; color: #0d6efd; white-space: nowrap; }
      .navbar-nav {
        display: flex;
        flex-direction: row;
        gap: 12px;
        list-style: none;
        margin: 0;
        padding: 0;
        align-items: center;
        flex-wrap: nowrap;
        white-space: nowrap;
      }
      .navbar-nav .nav-link { text-decoration: none; color: #0d6efd; padding: 6px 10px; border-radius: 6px; }
      .navbar-nav .nav-link:hover { background: #e9ecef; }
      .btn-outline-secondary { border: 1px solid #6c757d; color: #6c757d; padding: 6px 12px; border-radius: 6px; background: transparent; }
      .btn-outline-secondary:hover { background: #e9ecef; }
      .dropdown { position: relative; }
      .dropdown-toggle::after { content: "â–¾"; margin-left: 6px; font-size: 0.8em; }
      .dropdown-menu {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        min-width: 200px;
        padding: 6px 0;
        background: #fff;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        z-index: 1000;
      }
      .dropdown-menu .dropdown-item {
        display: block;
        padding: 6px 12px;
        text-decoration: none;
        color: #0d6efd;
        white-space: nowrap;
      }
      .dropdown-menu .dropdown-item:hover { background: #e9ecef; }
      .dropdown.open > .dropdown-menu { display: block; }
    </style>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        if (window.bootstrap && window.bootstrap.Dropdown) return;
        document.addEventListener("click", (event) => {
          const toggle = event.target.closest(".dropdown-toggle");
          const dropdown = toggle?.closest(".dropdown");
          document.querySelectorAll(".dropdown.open").forEach((el) => {
            if (el !== dropdown) el.classList.remove("open");
          });
          if (toggle && dropdown) {
            event.preventDefault();
            dropdown.classList.toggle("open");
            return;
          }
          if (!event.target.closest(".dropdown")) {
            document.querySelectorAll(".dropdown.open").forEach((el) => el.classList.remove("open"));
          }
        });
      });
    </script>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>
  </head>

  <body data-controller="theme-toggle" data-theme="light">
    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
      <div class="container-fluid">
        <%= link_to t("layouts.application.app_name"), root_path, class: "navbar-brand" %>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse d-flex align-items-center" id="navbarSupportedContent">
          <ul class="navbar-nav flex-row flex-wrap gap-2 me-auto mb-2 mb-lg-0">
            <li class="nav-item"><%= link_to t("nav.vouchers.index"), vouchers_path, class: "nav-link px-3" %></li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle px-3" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <%= t("nav.vouchers.menu") %>
              </a>
              <ul class="dropdown-menu">
                <li><%= link_to t("nav.vouchers.new"), new_voucher_path, class: "dropdown-item" %></li>
                <li><%= link_to t("nav.vouchers.quick"), quick_vouchers_path, class: "dropdown-item" %></li>
              </ul>
            </li>
            <li class="nav-item"><%= link_to t("nav.bank_imports"), new_bank_import_path, class: "nav-link px-3" %></li>
            <li class="nav-item"><%= link_to t("nav.accounts"), accounts_path, class: "nav-link px-3" %></li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle px-3" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <%= t("nav.options.menu") %>
              </a>
              <ul class="dropdown-menu">
                <li>
                  <button type="button" class="dropdown-item" data-action="click->theme-toggle#toggle" data-theme-toggle-target="button">
                    <%= t("nav.theme.to_dark") %>
                  </button>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <main class="container py-4">
      <%= yield %>
    </main>
  </body>
</html>
