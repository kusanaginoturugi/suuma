<% content_for :title, t("vouchers.new.title") %>

<div class="page-shell">
  <div class="hero">
    <p class="eyebrow">DOUBLE-ENTRY</p>
    <h1><%= t("vouchers.new.heading") %></h1>
    <p class="sub"><%= t("vouchers.new.sub") %></p>
    <div class="pill-row">
      <span class="pill"><%= t("vouchers.new.pill_draft") %></span>
      <span class="pill pill--accent"><%= t("vouchers.new.pill_balance") %></span>
      <%= link_to t("bank_imports.shared.import_button"), new_bank_import_path, class: "pill pill--ghost" %>
    </div>
  </div>

  <% if flash[:notice] %>
    <div class="flash flash--notice"><%= flash[:notice] %></div>
  <% end %>
  <% if flash[:alert] %>
    <div class="flash flash--alert"><%= flash[:alert] %></div>
  <% end %>

  <%= render "form", voucher: @voucher, accounts: @accounts, submit_label: t("vouchers.new.submit") %>

  <section class="card card--stacked" style="margin-top: 16px;">
    <div class="card__header">
      <div>
        <p class="eyebrow">ACCOUNTS</p>
        <h2><%= t("accounts.index.heading") %></h2>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-sm table-striped align-middle mb-0" style="font-size: 0.82rem;">
        <tbody>
          <% grouped = (@accounts || []).group_by(&:category) %>
          <% Account::CATEGORIES.each do |category| %>
            <% next if grouped[category].blank? %>
            <tr class="table-light">
              <td colspan="6" class="fw-bold"><%= t("accounts.categories.#{category}") %></td>
            </tr>
            <% grouped[category].each_slice(6) do |row| %>
              <tr>
                <% row.each do |account| %>
                  <td class="text-nowrap"><%= "#{account.code} #{account.name}" %></td>
                <% end %>
                <% (6 - row.size).times do %>
                  <td></td>
                <% end %>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
  </section>
</div>
